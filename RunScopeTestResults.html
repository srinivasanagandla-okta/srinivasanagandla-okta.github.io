<html>
<head>
    <script src="https://code.jquery.com/jquery-3.1.1.js"></script>
</head>
<body>
<table border='1' id='runScopeResults'>
<tr>
  <th> Test Name </th>
  <th> Trex Status </th>
  <th> Preview Status </th>  
  <th> OK1 Status </th>
  <th> OK2 Status </th>
  <th> OK3 Status </th>
  <th> OK4 Status </th>
  <th> OK5 Status </th>
  <th> EU Status </th>
<tbody>
</tbody>
</table>
</body>
<script type="text/javascript">
var bucketId = "r9hwi2ufyz00";
var environments = ["TC", "Preview", "OK1", "OK2", "OK3", "OK4", "OK5", "EU1" ];
//Add a row table with test-name and all the cells with the right id
$.ajax({
  url: "https://api.runscope.com/buckets/"+bucketId+"/tests?count=100"
}).done(function(response) {
  var tests = response.data;
  console.log("Number of tests in the bucket is = "+tests.length);
  var table = document.getElementById("runScopeResults");
  for (i=0; i<tests.length; i++) {
    var row = table.insertRow(-1);
    var nameCell = row.insertCell(0);
    nameCell.id = tests[i].id;
    nameCell.innerHTML = tests[i].name;
    for (j=1; j<=environments.length; j++) {
      var cell = row.insertCell(j);
      cell.id = environments[j-1]+"."+tests[i].id;
      cell.innerHTML = "&nbsp;";
    }
    //Now get results for the test
    $.ajax({
      url: "https://api.runscope.com/buckets/"+bucketId+"/tests/"+tests[i].id+"/results?count=8"
    }).done(function(testResultsResponse) {
      var results = testResultsResponse.data;
      for (resultIndex=0; resultIndex<results.length; resultIndex++) {
        var testResult = results[resultIndex];
        var environment_name = testResult.environment_name;
        var isSpacePresent = environment_name.indexOf(' ') > 1 ? true: false;
        if (isSpacePresent) {
          environment_name = environment_name.substr(0, environment_name.indexOf(' '));
        }
        var cell = document.getElementById(environment_name+"."+testResult.test_id);
        if (cell) {
          var testStatus = testResult.result
          cell.innerHTML = testStatus;
          if (testStatus == "pass") {
            cell.bgColor = "Green";
          } else if (testStatus == "fail") {
            cell.bgColor = "Red";
          }
        } else {
          console.log("Cell with Id = ["+environment_name+"."+testResult.test_id+"] not found");
        }
      }
    });
  }
});

</script>
</html>
