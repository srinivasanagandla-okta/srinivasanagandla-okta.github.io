<html>
  <script>
    function verifyWithUserNameSelector() {
      var randomChallengeBuffer = new Uint8Array(32); 
      window.crypto.getRandomValues(randomChallengeBuffer); 
      var base64id = 'MIIBkzCCATigAwIBAjCCAZMwggE4oAMCAQIwggGTMII=';
      var idBuffer = Uint8Array.from(window.atob(base64id), c=>c.charCodeAt(0));
      var authenticatorSelectionCriteria = {
        requireResidentKey: false,
        userVerification: "optional"
      };
      
      var verifyOptions = {
        challenge: idBuffer,
        authenticatorSelection: authenticatorSelectionCriteria,
        pubKeyCredParams: [
          {type: "public-key", alg: -7},
          {type: "public-key", alg: -257}
        ]
      }

      navigator.credentials.get({ publicKey: verifyOptions})
        .then(function (credential) {
            console.log(credential);
          }).catch(function (err) {
                console.log(err);
          });
    }

    function verify() {
      var randomChallengeBuffer = new Uint8Array(32); 
      window.crypto.getRandomValues(randomChallengeBuffer); 
      var base64id = 'MIIBkzCCATigAwIBAjCCAZMwggE4oAMCAQIwggGTMII=';
      var idBuffer = Uint8Array.from(window.atob(base64id), c=>c.charCodeAt(0));

      var authenticatorSelectionCriteria = {
        requireResidentKey: true,
        userVerification: "optional"
      };

      var verifyOptions = {
        challenge: idBuffer,
        rp: {
          id:"srinivasanagandla-okta.github.io",
          name: "ACME Corporation"
        },
        authenticatorSelection: authenticatorSelectionCriteria,
        pubKeyCredParams: [
          {type: "public-key", alg: -7},
          {type: "public-key", alg: -257}
        ]
      }

      navigator.credentials.get({ publicKey: verifyOptions})
        .then(function (credential) {
            console.log(credential);
          }).catch(function (err) {
                console.log(err);
          });
    }
    function enroll() {
      var randomChallengeBuffer = new Uint8Array(32); 
      window.crypto.getRandomValues(randomChallengeBuffer); 
      var base64id = 'MIIBkzCCATigAwIBAjCCAZMwggE4oAMCAQIwggGTMII=';
      var idBuffer = Uint8Array.from(window.atob(base64id), c=>c.charCodeAt(0));
      var authenticatorSelectionCriteria = {
        authenticatorAttachment: "platform",
        requireResidentKey: true,
        userVerification: "preferred"
      };
      
      var enrollExtensions = {
        uvm: true
      }
      
      var makeCredentialOptions = {
        challenge: randomChallengeBuffer,
        rp: {
          id:"srinivasanagandla-okta.github.io",
          name: "ACME Corporation"
        },
        user: {
          id: idBuffer,
          name: "user3@example.com",
          displayName: "Test User3"
        },
        pubKeyCredParams: [
          {type: "public-key", alg: -7},
          {type: "public-key", alg: -257}
        ]
      }
      navigator.credentials.create({
                publicKey: makeCredentialOptions
            }).then(function (newCredential) {
                    console.log("PublicKeyCredential Created");
                    console.log(newCredential);
            }).catch(function (err) {
                console.log(err);
            });
    }
  </script>
<body>
<input type="button" name="enroll" value="enroll" onclick="enroll()">
<input type="button" name="verify" value="verify" onclick="verify()">
<input type="button" name="verify_with_username_selector" value="Bring up username selector" onclick="verifyWithUserNameSelector()">  
</body>
</html>
